---
import Layout from "../../layouts/Layout.astro";
import Card from "../../components/Card.astro";
import { supabase } from "../../lib/supabase";

// Supabase에서 모든 게시물을 가져오는 함수
async function fetchPosts() {
  const { data, error } = await supabase
      .from('posts')
      .select('*')
      .order('id', { ascending: false });

  if (error) {
    console.error('Error fetching posts:', error);
    return [];
  }

  return data;
}

// 페이지에서 Supabase 함수를 호출하여 데이터를 가져옴
const posts = await fetchPosts();
---
<Layout title="모든 게시물" description="모든 게시물">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-3xl font-bold">모든 게시물</h1>
    <a href="/bbs/new-post" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 focus:outline-none">
      새로운 게시물 만들기
    </a>
  </div>
  <ul class="space-y-4">
    {posts.map((post: { id: string; title: string; content: string;}) => (
        <li>
          <Card href={`/bbs/${post.id}`} title={post.title} body={post.content} />
        </li>
    ))}
  </ul>
</Layout>
